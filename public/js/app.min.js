function ActivityList(){function a(a){a.find(".activity").click(function(a){d($(this).data("id"))})}function b(a,b){a.find(".button.approved").click(function(c){a.find(".activity").removeClass().addClass("activity approved"),a.find(".footer").text("approved"),i[b].case.approved="approved"}),a.find(".button.denied").click(function(c){a.find(".activity").removeClass().addClass("activity denied"),a.find(".footer").text("denied"),i[b].case.approved="denied"}),a.find(".button.pending").click(function(c){a.find(".activity").removeClass().addClass("activity pending"),a.find(".footer").text("pending"),i[b].case.approved="pending"})}function c(a){var b=[];return f.map(function(c){c.case.approved!=a&&"all"!=a||b.push(c)}),b}function d(a){g.map(function(b){b(a)})}function e(a){return a.split("/").reverse().join("-")}var f=[],g=[],h={},i={};this.render=function(b,d){if(f.length>0){var e=c(b);$.get("views/activities_list.html",function(b){var c=Mustache.render(b,{activities:e});$(d).html(c),a($(d))})}else{var g=this;this.load(function(){g.render(b,d)})}return this},this.renderActivity=function(a,c){if(f.length>0)$.get("views/activity.html",function(d){var e=Mustache.render(d,{activity:i[a]});$(c).html(e),b($(c),a)});else{var d=this;this.load(function(){d.renderActivity(a,c)})}return this},this.onSelect=function(a){return g.push(a),this},this.load=function(a){$.getJSON("/api/cases",function(b){b.map(function(a){a.beginDate=e(a.beginDate),a.endDate=e(a.endDate),a.lastVacationOn=e(a.lastVacationOn),a.image=faker.image.avatar(),a.approved=["pending","denied","approved"][Math.floor(3*Math.random())],h[a.caseId]=a}),$.getJSON("/api/processes",function(b){b.map(function(a){a.requestDate=e(a.requestDate),a.case=h[a.caseId],f.push(a),i[a.caseId]=a}),a&&a(f)})})}}function Menu(a){function b(a){f.find("li.active").removeClass("active"),f.find('li a[href="#'+a+'"]').parent().addClass("active")}function c(a,c){if(b(a),e.hasOwnProperty(a))for(var d=0;d<e[a].length;d++)e[a][d](c);else console.warn('Callback "'+a+'" missing.')}function d(){var a=window.location.hash.substr(1).split("/");switch(window.location.hash){case"#logout":c("logout",a);break;case"#account":c("account",a);break;case"#all":c("all",a);break;case"#approved":c("approved",a);break;case"#denied":c("denied",a);break;case"#pending":case"#":case"":c("pending",a);break;default:c("404",a)}}var e={},f=null;this.render=function(b){return f=$(b),$.get("views/menu.html",function(b){var c=Mustache.render(b,{user:a});f.html(c),d()}),this},this.on=function(a,b){return e[a]=e[a]||[],e[a].push(b),this},$(window).on("hashchange",d)}$(function(){$.mockjax({url:"/api/processes",proxy:"/api/inbox.json",responseTime:[500,750]}),$.mockjax({url:"/api/cases",proxy:"/api/cases.json",responseTime:[500,750]});var a=new Menu({name:faker.name.findName(),image:faker.image.avatar()}),b=new ActivityList;a.on("pending",function(){b.render("pending",$("section.body-section"))}).on("all",function(){b.render("all",$("section.body-section"))}).on("approved",function(){b.render("approved",$("section.body-section"))}).on("denied",function(){b.render("denied",$("section.body-section"))}).on("logout",function(){document.location.href="?"}).on("404",function(a){"activity"==a[0]&&b.renderActivity(a[1],$("section.body-section"))}).render($("aside.body-aside:first")),b.onSelect(function(a){document.location.href="#activity/"+a})});